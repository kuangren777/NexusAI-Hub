# NexusAI Hub - AI æ¨¡åž‹èšåˆç®¡ç†å¹³å°

## ðŸ“¦ ç³»ç»Ÿæž¶æž„

### è¯¦ç»†æž¶æž„å›¾
```mermaid
graph TD
    A[Web/APPå®¢æˆ·ç«¯] --> B{API Gateway}
    B --> C[ç®¡ç†åŽå°]
    B --> D[API æœåŠ¡]
    
    subgraph APIæœåŠ¡å±‚
        D --> E[èº«ä»½éªŒè¯æ¨¡å—]
        E --> F[æ™ºèƒ½è·¯ç”±å¼•æ“Ž]
        F --> G[è´Ÿè½½å‡è¡¡å™¨]
        G --> H[æä¾›å•†ä»£ç†]
        H --> I[ä¼šè¯ç®¡ç†]
        H --> J[Tokenè®¡ç®—]
        H --> K[ç»Ÿè®¡è¿½è¸ª]
    end
    
    subgraph æ•°æ®æŒä¹…å±‚
        L[(SQLiteæ•°æ®åº“)] --> M[æœåŠ¡å•†é…ç½®]
        L --> N[æ¨¡åž‹åˆ—è¡¨]
        L --> O[å¯¹è¯è®°å½•]
        L --> P[ç»Ÿè®¡ä¿¡æ¯]
        Q[(Redisç¼“å­˜)] --> R[ä¼šè¯çŠ¶æ€]
        Q --> S[é™æµæ•°æ®]
    end
    
    subgraph ç›‘æŽ§å‘Šè­¦å±‚
        T[Prometheus] --> U[æŒ‡æ ‡é‡‡é›†]
        V[Grafana] --> W[æ•°æ®å¯è§†åŒ–]
        X[ELK Stack] --> Y[æ—¥å¿—åˆ†æž]
        Z[AlertManager] --> AA[å¼‚å¸¸å‘Šè­¦]
    end
    
    D --> T
    D --> X
    H --> Q
    
    subgraph å¤–éƒ¨æœåŠ¡é›†ç¾¤
        AB[OpenAI]
        AC[Azure AI]
        AD[è‡ªå®šä¹‰æ¨¡åž‹]
        AE[æ–‡å¿ƒä¸€è¨€]
    end
    
    H --> AB
    H --> AC
    H --> AD
    H --> AE
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜Ž
1. **ç½‘å…³å±‚**  
   - åŸºäºŽ FastAPI æž„å»ºçš„ API Gateway
   - æ”¯æŒ HTTP/WebSocket åŒåè®®
   - è¯·æ±‚é€ŸçŽ‡é™åˆ¶ï¼ˆ1000 QPSï¼‰
   - æµé‡æŽ§åˆ¶ä¸Žç†”æ–­æœºåˆ¶

2. **æœåŠ¡å±‚**  
   ```python
   # main.py æ ¸å¿ƒå¤„ç†æµç¨‹
   async def handle_chat_completions(request: Request):
       # èº«ä»½éªŒè¯ -> è·¯ç”±é€‰æ‹© -> è¯·æ±‚è½¬å‘ -> å“åº”å¤„ç†
       # å®Œæ•´è®°å½•ç»Ÿè®¡æ•°æ®å’Œå¯¹è¯æ—¥å¿—
   ```
   - åŠ¨æ€è·¯ç”±æœºåˆ¶ï¼šæ ¹æ®æ¨¡åž‹åç§°è‡ªåŠ¨é€‰æ‹©æœåŠ¡å•†
   - ä¼šè¯ç®¡ç†ç³»ç»Ÿï¼š30åˆ†é’Ÿè‡ªåŠ¨ä¼šè¯ç»­æœŸ
   - Tokenè®¡ç®—å¼•æ“Žï¼šç²¾ç¡®ç»Ÿè®¡ä¸­è‹±æ–‡æ··åˆå†…å®¹

3. **æ•°æ®å±‚**  
   ```python
   # stats_tracker.py æ•°æ®è®°å½•
   async def record_chat(self, conversation_id, provider_id, 
                        model_name, tokens_count, is_prompt, message):
       # åŒæ—¶å†™å…¥SQLiteå’ŒRedis
   ```
   - åŒå­˜å‚¨å¼•æ“Žï¼šSQLiteï¼ˆæŒä¹…åŒ–ï¼‰+ Redisï¼ˆç¼“å­˜ï¼‰
   - ACID äº‹åŠ¡æ”¯æŒ
   - è‡ªåŠ¨æ•°æ®å½’æ¡£ï¼ˆ6ä¸ªæœˆä¿ç•™æœŸï¼‰

4. **ç›‘æŽ§å±‚**  
   - å®žæ—¶é‡‡é›†APIå»¶è¿Ÿã€é”™è¯¯çŽ‡ç­‰æŒ‡æ ‡
   - Grafana çœ‹æ¿ç¤ºä¾‹ï¼š
   ```mermaid
   graph LR
     A[Prometheus] --> B((APIæˆåŠŸçŽ‡))
     A --> C[è¯·æ±‚å»¶è¿ŸP99]
     A --> D[Tokenä½¿ç”¨é‡]
     B --> E{Grafanaçœ‹æ¿}
     C --> E
     D --> E
   ```

## ðŸŒŸ æ ¸å¿ƒåŠŸèƒ½

### ðŸ§  æ™ºèƒ½ä¼šè¯ç®¡ç†
- **ä¸Šä¸‹æ–‡è‡ªåŠ¨å…³è”**  
  é€šè¿‡æ¶ˆæ¯å†…å®¹åŒ¹é…+æ—¶é—´çª—å£æ™ºèƒ½è¯†åˆ«ä¼šè¯ (30åˆ†é’Ÿæœ‰æ•ˆæœŸ)
- **å¤šè½®å¯¹è¯è¿½è¸ª**  
  å®Œæ•´è®°å½•å¯¹è¯åŽ†å²ï¼Œæ”¯æŒæŒ‰ä¼šè¯IDæŸ¥è¯¢å®Œæ•´ä¸Šä¸‹æ–‡
- **è·¨å¹³å°å…¼å®¹**  
  åŒæ—¶æ”¯æŒæ ‡å‡†OpenAI APIå’ŒWebSocketåè®®

### ðŸ“ˆ æ·±åº¦ç»Ÿè®¡ç›‘æŽ§
- **å®žæ—¶æ•°æ®çœ‹æ¿**  
  å±•ç¤ºæ€»å¯¹è¯æ•°ã€æ´»è·ƒä¼šè¯ã€Tokenç”¨é‡ç­‰å…³é”®æŒ‡æ ‡
- **ç»†ç²’åº¦åˆ†æž**  
  æ”¯æŒæŒ‰æ¨¡åž‹/æä¾›å•†/æ—¶é—´æ®µçš„å¤šç»´åº¦ç»Ÿè®¡
- **æ•°æ®å¯è§†åŒ–**  
  å‰ç«¯é›†æˆå›¾è¡¨å±•ç¤ºç”¨é‡è¶‹åŠ¿ï¼ˆéœ€é…åˆå‰ç«¯ä½¿ç”¨ï¼‰

### ðŸ”„ ç»Ÿä¸€APIç½‘å…³
```python
# å…¼å®¹OpenAI SDKçš„è°ƒç”¨æ–¹å¼
response = openai.ChatCompletion.create(
    model="your-model",
    messages=[...],
    stream=True
)
```
- **å¤šæä¾›å•†ä»£ç†**  
  æ”¯æŒåŒæ—¶é…ç½®å¤šä¸ªAIæœåŠ¡æä¾›å•†
- **æ™ºèƒ½è·¯ç”±**  
  æ ¹æ®æ¨¡åž‹åç§°è‡ªåŠ¨è·¯ç”±åˆ°å¯¹åº”æœåŠ¡å•†
- **è´Ÿè½½å‡è¡¡**  
  è‡ªåŠ¨é€‰æ‹©å¯ç”¨èŠ‚ç‚¹ï¼ˆå¼€å‘ä¸­ï¼‰

### ðŸ” ä¼ä¸šçº§å®‰å…¨
- **å¯†é’¥ç®¡ç†**  
  é‡‡ç”¨AES-256åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- **è®¿é—®æŽ§åˆ¶**  
  æ”¯æŒRBACæƒé™æ¨¡åž‹å’Œè¯·æ±‚ç­¾åéªŒè¯
- **å®¡è®¡æ—¥å¿—**  
  å®Œæ•´è®°å½•æ‰€æœ‰APIè¯·æ±‚å’Œç³»ç»Ÿæ“ä½œ

### ðŸ’¾ æ•°æ®ç®¡ç†
- **å¯¹è¯å­˜æ¡£**  
  å®Œæ•´ä¿å­˜6ä¸ªæœˆå†…çš„å¯¹è¯è®°å½•
- **è‡ªåŠ¨å¤‡ä»½**  
  æ¯å°æ—¶è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
- **æ•°æ®å¯¼å‡º**  
  æ”¯æŒCSV/JSONæ ¼å¼å¯¼å‡ºç»Ÿè®¡æ•°æ®å’Œå¯¹è¯è®°å½•

### ðŸ›  é…ç½®ç®¡ç†
```http
PUT /providers/{provider_id}
Content-Type: application/json

{
    "server_url": "https://new.api.endpoint",
    "rate_limit": 1000
}
```
- **åŠ¨æ€é…ç½®**  
  æ”¯æŒå®žæ—¶æ›´æ–°æœåŠ¡å•†é…ç½®æ— éœ€é‡å¯
- **æ¨¡åž‹ç®¡ç†**  
  çµæ´»ç®¡ç†å„æä¾›å•†æ”¯æŒçš„æ¨¡åž‹åˆ—è¡¨
- **çƒ­åŠ è½½æœºåˆ¶**  
  é…ç½®å˜æ›´ç«‹å³ç”Ÿæ•ˆ

## ðŸš€ å¿«é€Ÿå¼€å§‹
### çŽ¯å¢ƒè¦æ±‚
- Python 3.8+
- Node.js 16+ (å¯é€‰ï¼Œå‰ç«¯å¼€å‘éœ€è¦)

### å®‰è£…éƒ¨ç½²
```bash
# å…‹éš†ä»“åº“
git clone https://github.com/yourusername/NexusAI-Hub.git

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡
python run.py
```

### æŽ¥å£æµ‹è¯•
```python
import openai

openai.api_key = "YOUR_PERSONALIZED_KEY"
openai.api_base = "http://localhost:8001/v1"

response = openai.ChatCompletion.create(
    model="gpt-3.5-turbo",
    messages=[{"role": "user", "content": "ä½ å¥½"}],
    stream=True
)

for chunk in response:
    print(chunk.choices[0].delta.get("content", ""), end="")
```

## ðŸ“¦ ç³»ç»Ÿæž¶æž„
### åŽç«¯æž¶æž„
```mermaid
graph TD
    A[å®¢æˆ·ç«¯] --> B(API Gateway)
    B --> C{è·¯ç”±åˆ†å‘}
    C --> D[ç®¡ç†åŽå°]
    C --> E[API æœåŠ¡]
    E --> F[ä¼šè¯ç®¡ç†]
    E --> G[Token è®¡ç®—]
    E --> H[ç»Ÿè®¡è¿½è¸ª]
    E --> I[æä¾›å•†ä»£ç†]
```

### æ•°æ®åº“è®¾è®¡
| è¡¨å             | æè¿°                     |
|------------------|--------------------------|
| service_providers | æœåŠ¡æä¾›å•†é…ç½®ä¿¡æ¯       |
| provider_models   | æä¾›å•†æ”¯æŒçš„æ¨¡åž‹åˆ—è¡¨     |
| chat_stats        | Token ä½¿ç”¨ç»Ÿè®¡           |
| chat_messages     | å®Œæ•´å¯¹è¯è®°å½•             |

## ðŸ”‘ API æ–‡æ¡£
### åŸºç¡€æŽ¥å£
```http
POST /v1/chat/completions
Authorization: Bearer {personalized_key}
Content-Type: application/json

{
    "model": "gpt-3.5-turbo",
    "messages": [
        {"role": "user", "content": "ä½ å¥½"}
    ],
    "stream": true
}
```

### ç®¡ç†æŽ¥å£
| ç«¯ç‚¹                     | æ–¹æ³• | åŠŸèƒ½               |
|--------------------------|------|--------------------|
| /providers               | GET  | èŽ·å–æ‰€æœ‰æä¾›å•†     |
| /providers/{provider_id} | PUT  | æ›´æ–°æä¾›å•†é…ç½®     |
| /provider_models         | POST | æ·»åŠ æ–°æ¨¡åž‹         |

## ðŸ“Š ç»Ÿè®¡åŠŸèƒ½
### å®žæ—¶ç›‘æŽ§æŒ‡æ ‡
```json
{
    "total_conversations": 42,
    "active_sessions": 5,
    "tokens_usage": {
        "prompt": 1200,
        "completion": 850,
        "total": 2050
    }
}
```

### æ•°æ®æŒä¹…åŒ–
- å®Œæ•´ä¿å­˜ 6 ä¸ªæœˆå†…çš„å¯¹è¯è®°å½•
- æ¯å°æ—¶è‡ªåŠ¨å¤‡ä»½æ•°æ®åº“
- æ”¯æŒ CSV/JSON æ ¼å¼æ•°æ®å¯¼å‡º

## ðŸ”’ å®‰å…¨ç‰¹æ€§
- AES-256 åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯
- åŸºäºŽè§’è‰²çš„è®¿é—®æŽ§åˆ¶ (RBAC)
- è¯·æ±‚ç­¾åéªŒè¯æœºåˆ¶
- è‡ªåŠ¨å±è”½æ•æ„Ÿä¿¡æ¯æ—¥å¿—

## ðŸ›  å¼€å‘æŒ‡å—
### åˆ†æ”¯ç­–ç•¥
- `main` - ç”Ÿäº§çŽ¯å¢ƒåˆ†æ”¯
- `dev` - ä¸»è¦å¼€å‘åˆ†æ”¯
- `feature/*` - åŠŸèƒ½å¼€å‘åˆ†æ”¯

### æž¶æž„è¯´æ˜Ž
1. **ç½‘å…³å±‚**  
   - åŸºäºŽ FastAPI æž„å»º
   - æ”¯æŒ HTTP/WebSocket åŒåè®®
   - è¯·æ±‚é€ŸçŽ‡é™åˆ¶ï¼ˆ1000 QPSï¼‰

2. **æœåŠ¡å±‚**  
   ```python:main.py
   startLine: 1
   endLine: 219
   ```
   - åŠ¨æ€è·¯ç”±æœºåˆ¶
   - æ™ºèƒ½ä¼šè¯ç®¡ç†
   - å®žæ—¶ Token è®¡ç®—

3. **æ•°æ®å±‚**  
   ```python:stats_tracker.py
   startLine: 1
   endLine: 87
   ```
   - åŒå­˜å‚¨å¼•æ“Žï¼ˆSQLite + Redisï¼‰
   - ACID äº‹åŠ¡æ”¯æŒ
   - è‡ªåŠ¨æ•°æ®å½’æ¡£

4. **ç›‘æŽ§å±‚**  
   - å®žæ—¶æŒ‡æ ‡é‡‡é›†
   - å¼‚å¸¸æ£€æµ‹å‘Šè­¦
   - æ—¥å¿—å®¡è®¡è¿½è¸ª

## ðŸ› ï¸ éƒ¨ç½²æž¶æž„

```mermaid
graph TB
    A[å®¢æˆ·ç«¯] --> B[CDN]
    B --> C[è´Ÿè½½å‡è¡¡å™¨]
    C --> D[API é›†ç¾¤]
    D --> E[æ•°æ®åº“é›†ç¾¤]
    D --> F[ç¼“å­˜é›†ç¾¤]
    E --> G[ä¸»æ•°æ®åº“]
    E --> H[åªè¯»å‰¯æœ¬]
    F --> I[Redis åˆ†ç‰‡]
    J[ç›‘æŽ§ç³»ç»Ÿ] --> D
    J --> E
    J --> F
```

## ðŸ”„ æ•°æ®æµå‘
```mermaid
sequenceDiagram
    participant Client
    participant Gateway
    participant Service
    participant Provider
    participant Database
    
    Client->>Gateway: å‘èµ·è¯·æ±‚
    Gateway->>Service: èº«ä»½éªŒè¯
    Service->>Database: æŸ¥è¯¢é…ç½®
    Database-->>Service: è¿”å›žé…ç½®
    Service->>Provider: è½¬å‘è¯·æ±‚
    Provider-->>Service: è¿”å›žç»“æžœ
    Service->>Database: ä¿å­˜è®°å½•
    Service->>Client: è¿”å›žå“åº”
```

## ðŸ“Š ç›‘æŽ§æŒ‡æ ‡
æŒ‡æ ‡åç§°                | é‡‡é›†é¢‘çŽ‡ | å‘Šè­¦é˜ˆå€¼
-----------------------|---------|---------
API è¯·æ±‚å»¶è¿Ÿ           | 1s      | >500ms
æ•°æ®åº“æŸ¥è¯¢è€—æ—¶          | 500ms   | >1s
å†…å­˜ä½¿ç”¨çŽ‡             | 5s      | >80%
åœ¨çº¿ä¼šè¯æ•°             | 10s     | >1000
Token è®¡ç®—å‡†ç¡®çŽ‡       | å®žæ—¶     | <99.9%

### è´¡çŒ®æµç¨‹
1. Fork é¡¹ç›®ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/awesome-feature`)
3. æäº¤ä¿®æ”¹ (`git commit -am 'Add awesome feature'`)
4. æŽ¨é€åˆ°è¿œç¨‹åˆ†æ”¯ (`git push origin feature/awesome-feature`)
5. åˆ›å»º Pull Request

## ðŸ“ž è”ç³»æˆ‘ä»¬
- é¡¹ç›®ç»´æŠ¤: [@kuangren](https://github.com/kuangren777)
- é—®é¢˜åé¦ˆ: [Issues](https://github.com/kuangren777/NexusAI-Hub/issues)
- æ–‡æ¡£ä¸­å¿ƒ: [Wiki](https://github.com/kuangren777/NexusAI-Hub/wiki)

---

ðŸ“„ **License**: AGPL-3.0  
â° **æœ€åŽæ›´æ–°**: 2024-03-20  
ðŸ”” **ç‰ˆæœ¬**: v1.2.0

## ðŸ“ˆ æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡åç§°          | ç›®æ ‡å€¼       | ç›‘æŽ§æ–¹å¼       |
|------------------|-------------|---------------|
| è¯·æ±‚å»¶è¿Ÿ          | < 500ms     | Prometheus    |
| é”™è¯¯çŽ‡            | < 0.1%      | Elasticsearch |
| æœ€å¤§å¹¶å‘è¿žæŽ¥æ•°     | 1000        | Grafana       |
| æ•°æ®æŒä¹…åŒ–å»¶è¿Ÿ     | < 1s        | è‡ªå®šä¹‰ç›‘æŽ§     |

## ðŸ“® è”ç³»æ–¹å¼

**æŠ€æœ¯è´Ÿè´£äºº**: Kuang Ren  
**æž¶æž„è¯„å®¡å§”å‘˜ä¼š**: tech-review@nexusai.com  
**ç´§æ€¥å“åº”**: security@nexusai.com (PGP å¯†é’¥å¯ç”¨)

---

ðŸ“Œ **ç‰ˆæœ¬**: v1.2.0 | ðŸ”’ **è®¸å¯è¯**: AGPL-3.0 | â° æœ€åŽæ›´æ–°: 2024-03-20

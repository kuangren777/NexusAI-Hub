# NexusAI Hub - AIæ¨¡å‹èšåˆç®¡ç†å¹³å°

## é¡¹ç›®ç®€ä»‹
NexusAI Hub æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ AI æ¨¡å‹èšåˆç®¡ç†å¹³å°ï¼Œæ”¯æŒå¤šä¸ª AI æœåŠ¡æä¾›å•†çš„ç»Ÿä¸€æ¥å…¥å’Œç®¡ç†ã€‚è¯¥å¹³å°æä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ Web ç•Œé¢ï¼Œæ”¯æŒå®æ—¶å¯¹è¯æµ‹è¯•ã€Token è®¡ç®—ã€ä½¿ç”¨ç»Ÿè®¡ç­‰åŠŸèƒ½ï¼Œæ—¨åœ¨ç®€åŒ– AI æœåŠ¡çš„ç®¡ç†ä¸äº¤äº’ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œæ•ˆç‡ã€‚

## ä¸»è¦ç‰¹æ€§
- ğŸš€ **å¤šæä¾›å•†æ”¯æŒ**ï¼šå¯ä»¥ç»Ÿä¸€ç®¡ç†å¤šä¸ª AI æœåŠ¡æä¾›å•†ï¼Œæ–¹ä¾¿ä¸åŒå¹³å°çš„æ¥å…¥ä¸ç®¡ç†ã€‚
- ğŸ¤– **æ¨¡å‹ç®¡ç†**ï¼šçµæ´»é…ç½®å’Œç®¡ç†ä¸åŒæä¾›å•†çš„ AI æ¨¡å‹ï¼Œæ”¯æŒæ¨¡å‹çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ“ä½œã€‚
- ğŸ’¬ **å®æ—¶å¯¹è¯**ï¼šé€šè¿‡ WebSocket å®ç°çš„å®æ—¶å¯¹è¯æµ‹è¯•ï¼Œæ”¯æŒå³æ—¶å“åº”ä¸äº¤äº’ã€‚
- ğŸ“Š **æ•°æ®ç»Ÿè®¡**ï¼šè¯¦ç»†å±•ç¤ºå¯¹è¯è½®æ¬¡å’Œ Token ä½¿ç”¨ç»Ÿè®¡ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£ä½¿ç”¨æƒ…å†µã€‚
- ğŸŒ“ **ä¸»é¢˜åˆ‡æ¢**ï¼šæ”¯æŒæ˜æš—ä¸¤ç§ä¸»é¢˜æ¨¡å¼ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®ä¸ªäººå–œå¥½è°ƒæ•´ç•Œé¢é£æ ¼ã€‚
- ğŸ” **å¯†é’¥ç®¡ç†**ï¼šæä¾›å®‰å…¨çš„æœåŠ¡å™¨å¯†é’¥ç®¡ç†åŠä¸ªæ€§åŒ–å¯†é’¥ç®¡ç†æœºåˆ¶ï¼Œä¿éšœæ•°æ®å®‰å…¨ã€‚
- ğŸ“ **Token è®¡ç®—**ï¼šæ”¯æŒå¤šç§æ¨¡å‹çš„ Token è®¡ç®—åŠŸèƒ½ï¼Œå®æ—¶ä¼°ç®— Token ä½¿ç”¨é‡ã€‚

## æŠ€æœ¯æ ˆ
- **åç«¯**ï¼šFastAPI + SQLite + WebSocket
- **å‰ç«¯**ï¼šåŸç”Ÿ JavaScript + HTML5 + CSS3
- **æ•°æ®åº“**ï¼šSQLite3
- **å·¥å…·åº“**ï¼š
  - **marked.js**ï¼šç”¨äº Markdown æ¸²æŸ“ã€‚
  - **highlight.js**ï¼šç”¨äºä»£ç é«˜äº®æ˜¾ç¤ºã€‚
  - **Font Awesome**ï¼šæä¾›å›¾æ ‡æ”¯æŒã€‚

## ç³»ç»Ÿæ¶æ„
### åç«¯ç»„ä»¶
1. **main.py**
   - FastAPI åº”ç”¨çš„ä¸»å…¥å£æ–‡ä»¶ã€‚
   - è´Ÿè´£ API è·¯ç”±å¤„ç†ã€‚
   - å¤„ç† WebSocket å®æ—¶é€šä¿¡ã€‚
   - è½¬å‘è¯·æ±‚å¹¶å¤„ç†å“åº”ã€‚
   
2. **database.py**
   - æ•°æ®åº“åˆå§‹åŒ–å’Œç®¡ç†æ–‡ä»¶ã€‚
   - æä¾›å•†å’Œæ¨¡å‹çš„ CRUD æ“ä½œã€‚
   - æ”¯æŒæ•°æ®æŸ¥è¯¢å’Œç»Ÿè®¡åŠŸèƒ½ã€‚

3. **stats_tracker.py**
   - è·Ÿè¸ªå¯¹è¯ç»Ÿè®¡ä¿¡æ¯ã€‚
   - æä¾› Token è®¡ç®—å’Œä¼°ç®—åŠŸèƒ½ã€‚
   - è¿›è¡Œä½¿ç”¨æ•°æ®åˆ†æï¼Œå¸®åŠ©ä¼˜åŒ–èµ„æºä½¿ç”¨ã€‚

### å‰ç«¯ç»„ä»¶
1. **index.html**
   - å“åº”å¼ç”¨æˆ·ç•Œé¢è®¾è®¡ï¼Œå…¼å®¹ä¸åŒè®¾å¤‡ã€‚
   - å®æ—¶å¯¹è¯æµ‹è¯•çª—å£ã€‚
   - æ•°æ®ç®¡ç†ç•Œé¢ï¼Œæ–¹ä¾¿æŸ¥çœ‹å’Œä¿®æ”¹è®¾ç½®ã€‚
   - ç»Ÿè®¡å±•ç¤ºé¢æ¿ï¼Œç›´è§‚å‘ˆç°ä½¿ç”¨æ•°æ®ã€‚

## æ•°æ®åº“ç»“æ„
### `service_providers` è¡¨ç»“æ„
```sql
CREATE TABLE service_providers (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  name TEXT NOT NULL,
  server_url TEXT NOT NULL,
  server_key TEXT NOT NULL,
  personalized_key TEXT NOT NULL,
  description TEXT
);
```

### `provider_models` è¡¨ç»“æ„
```sql
CREATE TABLE provider_models (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  provider_id INTEGER NOT NULL,
  model_name TEXT NOT NULL,
  description TEXT,
  FOREIGN KEY (provider_id) REFERENCES service_providers (id),
  UNIQUE(provider_id, model_name)
);
```

### `chat_stats` è¡¨ç»“æ„
```sql
CREATE TABLE chat_stats (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  timestamp TEXT NOT NULL,
  conversation_id TEXT NOT NULL,
  provider_id INTEGER NOT NULL,
  model_name TEXT NOT NULL,
  tokens_count INTEGER NOT NULL,
  is_prompt BOOLEAN NOT NULL
);
```

## å®‰è£…å’Œå¯åŠ¨
1. å®‰è£…æ‰€éœ€çš„ Python åŒ…ï¼š
   ```bash
   pip install fastapi uvicorn aiosqlite httpx
   ```

2. å¯åŠ¨ FastAPI åº”ç”¨ï¼š
   ```bash
   uvicorn main:app --reload --host 127.0.0.1 --port 8000
   ```

## APIæ¥å£æ–‡æ¡£

### OpenAI å…¼å®¹æ¥å£

NexusAI Hub æä¾›äº†ä¸ OpenAI API æ ¼å¼å…¼å®¹çš„æ¥å£ï¼Œå¯ä»¥ç›´æ¥æ›¿æ¢ OpenAI çš„æ¥å£åœ°å€ä½¿ç”¨ã€‚

#### åŸºç¡€ä¿¡æ¯
- æ¥å£åœ°å€ï¼š`http://your-domain:8001`
- è®¤è¯æ–¹å¼ï¼šBearer Tokenï¼ˆä½¿ç”¨æä¾›å•†çš„ä¸ªæ€§åŒ–å¯†é’¥ï¼‰
- è¯·æ±‚æ ¼å¼ï¼šJSON
- å“åº”æ ¼å¼ï¼šStream æˆ– JSON

#### Chat Completions API

##### 1. æ ‡å‡†æ ¼å¼ï¼ˆOpenAI å…¼å®¹ï¼‰
```http
POST /v1/chat/completions
Authorization: Bearer YOUR_PERSONALIZED_KEY
Content-Type: application/json

{
    "model": "MODEL_NAME",
    "messages": [
        {"role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªåŠ©æ‰‹"},
        {"role": "user", "content": "ä½ å¥½"}
    ],
    "temperature": 0.7,
    "stream": true
}
```

##### 2. ç®€åŒ–æ ¼å¼
```http
POST /chat/completions
Authorization: Bearer YOUR_PERSONALIZED_KEY
Content-Type: application/json

{
    "model": "MODEL_NAME",
    "messages": [
        {"role": "user", "content": "ä½ å¥½"}
    ]
}
```

#### å“åº”æ ¼å¼

##### æµå¼å“åº” (stream=true)
```json
data: {"id":"chatcmpl-123","object":"chat.completion.chunk","created":1694839621,"model":"gpt-3.5-turbo-0613","choices":[{"index":0,"delta":{"content":"ä½ "},"finish_reason":null}]}

data: {"id":"chatcmpl-123","object":"chat.completion.chunk","created":1694839621,"model":"gpt-3.5-turbo-0613","choices":[{"index":0,"delta":{"content":"å¥½"},"finish_reason":null}]}

data: {"id":"chatcmpl-123","object":"chat.completion.chunk","created":1694839621,"model":"gpt-3.5-turbo-0613","choices":[{"index":0,"delta":{"content":"ï¼"},"finish_reason":null}]}

data: {"id":"chatcmpl-123","object":"chat.completion.chunk","created":1694839621,"model":"gpt-3.5-turbo-0613","choices":[{"index":0,"delta":{},"finish_reason":"stop"}]}
```

##### éæµå¼å“åº” (stream=false)
```json
{
    "id": "chatcmpl-123",
    "object": "chat.completion",
    "created": 1694839621,
    "model": "gpt-3.5-turbo-0613",
    "choices": [
        {
            "index": 0,
            "message": {
                "role": "assistant",
                "content": "ä½ å¥½ï¼"
            },
            "finish_reason": "stop"
        }
    ],
    "usage": {
        "prompt_tokens": 10,
        "completion_tokens": 3,
        "total_tokens": 13
    }
}
```

#### è¯·æ±‚å‚æ•°è¯´æ˜

| å‚æ•°å | ç±»å‹ | å¿…é€‰ | è¯´æ˜ |
|--------|------|------|------|
| model | string | æ˜¯ | æ¨¡å‹åç§°ï¼Œéœ€è¦åœ¨ç®¡ç†åå°é…ç½® |
| messages | array | æ˜¯ | å¯¹è¯æ¶ˆæ¯æ•°ç»„ |
| temperature | float | å¦ | æ¸©åº¦å‚æ•°ï¼Œæ§åˆ¶éšæœºæ€§ï¼Œé»˜è®¤ 0.7 |
| stream | boolean | å¦ | æ˜¯å¦ä½¿ç”¨æµå¼å“åº”ï¼Œé»˜è®¤ true |

#### é”™è¯¯å“åº”
```json
{
    "error": {
        "message": "é”™è¯¯ä¿¡æ¯",
        "type": "invalid_request_error",
        "code": "invalid_api_key"
    }
}
```

### ä½¿ç”¨ç¤ºä¾‹

#### Python
```python
import openai

openai.api_key = "YOUR_PERSONALIZED_KEY"
openai.api_base = "http://your-domain:8001/v1"

response = openai.ChatCompletion.create(
    model="MODEL_NAME",
    messages=[
        {"role": "user", "content": "ä½ å¥½"}
    ],
    stream=True
)

for chunk in response:
    if chunk and chunk.choices and chunk.choices[0].delta.content:
        print(chunk.choices[0].delta.content, end="")
```

#### JavaScript
```javascript
const response = await fetch('http://your-domain:8001/v1/chat/completions', {
    method: 'POST',
    headers: {
        'Authorization': `Bearer ${YOUR_PERSONALIZED_KEY}`,
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        model: 'MODEL_NAME',
        messages: [
            { role: 'user', content: 'ä½ å¥½' }
        ],
        stream: true
    })
});

const reader = response.body.getReader();
const decoder = new TextDecoder();

while (true) {
    const { value, done } = await reader.read();
    if (done) break;
    
    const chunk = decoder.decode(value);
    const lines = chunk.split('\n');
    
    for (const line of lines) {
        if (line.startsWith('data: ')) {
            const data = JSON.parse(line.slice(6));
            if (data.choices[0].delta.content) {
                process.stdout.write(data.choices[0].delta.content);
            }
        }
    }
}
```

## ç‰¹è‰²åŠŸèƒ½

1. **æ™ºèƒ½Tokenè®¡ç®—**
   - æ”¯æŒä¸­è‹±æ–‡æ··åˆ Token è®¡ç®—ã€‚
   - æä¾›å¿«é€Ÿä¼°ç®—åŠŸèƒ½ï¼Œå¸®åŠ©ç”¨æˆ·å®æ—¶äº†è§£ Token ä½¿ç”¨æƒ…å†µã€‚

2. **å®æ—¶å¯¹è¯æµ‹è¯•**
   - WebSocket å®æ—¶å“åº”ï¼Œæ”¯æŒæµå¼è¾“å‡ºã€‚
   - æ”¯æŒ Markdown æ¸²æŸ“ï¼Œæ–¹ä¾¿æ˜¾ç¤ºæ ¼å¼åŒ–æ–‡æœ¬ã€‚

3. **æ•°æ®å¯è§†åŒ–**
   - æä¾›ç»Ÿè®¡å›¾è¡¨ï¼Œç›´è§‚å±•ç¤ºå¯¹è¯å’Œ Token ä½¿ç”¨æƒ…å†µã€‚
   - å®æ—¶æ›´æ–°æ•°æ®ï¼Œç¡®ä¿æ•°æ®çš„å‡†ç¡®æ€§å’Œæ—¶æ•ˆæ€§ã€‚

## å®‰å…¨ç‰¹æ€§
- **æœåŠ¡å™¨å¯†é’¥åŠ å¯†å­˜å‚¨**ï¼šæ‰€æœ‰æœåŠ¡å™¨å¯†é’¥ä½¿ç”¨åŠ å¯†æŠ€æœ¯å®‰å…¨å­˜å‚¨ã€‚
- **ä¸ªæ€§åŒ–å¯†é’¥è®¿é—®æ§åˆ¶**ï¼šé€šè¿‡æƒé™ç®¡ç†ç³»ç»Ÿï¼Œç¡®ä¿æ¯ä¸ªå¯†é’¥çš„ä½¿ç”¨æƒé™åˆç†ã€‚
- **è¯·æ±‚éªŒè¯å’Œé‰´æƒ**ï¼šé‡‡ç”¨æ ‡å‡†çš„éªŒè¯æœºåˆ¶ç¡®ä¿æ‰€æœ‰è¯·æ±‚çš„åˆæ³•æ€§å’Œå®‰å…¨æ€§ã€‚

## ä½¿ç”¨å»ºè®®
1. **å®šæœŸå¤‡ä»½æ•°æ®åº“**ï¼šä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œå»ºè®®å®šæœŸè¿›è¡Œæ•°æ®åº“å¤‡ä»½ã€‚
2. **åŠæ—¶æ›´æ–°æœåŠ¡å™¨å¯†é’¥**ï¼šå®šæœŸæ›´æ–°å¯†é’¥ä»¥æå‡å®‰å…¨æ€§ã€‚
3. **ç›‘æ§ Token ä½¿ç”¨æƒ…å†µ**ï¼šå®šæœŸæ£€æŸ¥ Token ä½¿ç”¨æƒ…å†µï¼Œé¿å…è¶…å‡ºé…é¢ã€‚
4. **æ ¹æ®éœ€æ±‚è°ƒæ•´æ¨¡å‹é…ç½®**ï¼šæ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œçµæ´»è°ƒæ•´æ¨¡å‹é…ç½®ä»¥æé«˜æ•ˆç‡å’Œé™ä½æˆæœ¬ã€‚

## è´¡çŒ®æŒ‡å—
æ¬¢è¿æäº¤ Issues å’Œ Pull Requestsï¼Œæäº¤æ—¶è¯·ç¡®ä¿ï¼š
1. ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚
2. æä¾›å®Œæ•´çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿åŠŸèƒ½çš„ç¨³å®šæ€§ã€‚
3. æ›´æ–°ç›¸å…³æ–‡æ¡£ï¼Œå¸®åŠ©å…¶ä»–å¼€å‘è€…ç†è§£å’Œä½¿ç”¨é¡¹ç›®ã€‚

## è®¸å¯è¯
MIT License

## è”ç³»æ–¹å¼
- é¡¹ç›®ç»´æŠ¤è€…ï¼škuangren
- é‚®ç®±ï¼šluomingyu2002@126.com
- é¡¹ç›®åœ°å€ï¼š[\[GitHub Repository URL\]](https://github.com/kuangren777/NexusAI-Hub)
